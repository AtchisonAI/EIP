(function(j){var Q=[i18n.xgcalendar.dateformat.sun,i18n.xgcalendar.dateformat.mon,i18n.xgcalendar.dateformat.tue,i18n.xgcalendar.dateformat.wed,i18n.xgcalendar.dateformat.thu,i18n.xgcalendar.dateformat.fri,i18n.xgcalendar.dateformat.sat],wa=[i18n.xgcalendar.dateformat.jan,i18n.xgcalendar.dateformat.feb,i18n.xgcalendar.dateformat.mar,i18n.xgcalendar.dateformat.apr,i18n.xgcalendar.dateformat.may,i18n.xgcalendar.dateformat.jun,i18n.xgcalendar.dateformat.jul,i18n.xgcalendar.dateformat.aug,i18n.xgcalendar.dateformat.sep,
i18n.xgcalendar.dateformat.oct,i18n.xgcalendar.dateformat.nov,i18n.xgcalendar.dateformat.dec];if(!Y||typeof Y!="function")var Y=function(g){var r={};r=g.constructor==Object?new g.constructor:new g.constructor(g.valueOf());for(var q in g)if(r[q]!=g[q])r[q]=typeof g[q]=="object"?Y(g[q]):g[q];r.toString=g.toString;r.valueOf=g.valueOf;return r};if(!s||typeof s!="function")var s=function(g){var r={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()>12?this.getHours()-12:this.getHours(),"H+":this.getHours(),
"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),w:"0123456".indexOf(this.getDay()),t:this.getHours()<12?i18n.xgcalendar.dateformat.AM:i18n.xgcalendar.dateformat.PM,W:Q[this.getDay()],L:wa[this.getMonth()]};if(/(y+)/.test(g))g=g.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var q in r)if(RegExp("("+q+")").test(g))g=g.replace(RegExp.$1,RegExp.$1.length==1?r[q]:("00"+r[q]).substr((""+r[q]).length));return g};if(!z||typeof A!="function")var z=
function(g,r,q){r=parseInt(r);var y;if(typeof q=="string"){y=q.split(/\D/);eval("var date = new Date("+y.join(",")+")")}if(typeof q=="object")y=new Date(q.toString());switch(g){case "y":y.setFullYear(y.getFullYear()+r);break;case "m":y.setMonth(y.getMonth()+r);break;case "d":y.setDate(y.getDate()+r);break;case "w":y.setDate(y.getDate()+7*r);break;case "h":y.setHours(y.getHours()+r);break;case "n":y.setMinutes(y.getMinutes()+r);break;case "s":y.setSeconds(y.getSeconds()+r);break;case "l":y.setMilliseconds(y.getMilliseconds()+
r)}return y};if(!A||typeof A!="function")var A=function(g,r,q){switch(g){case "d":case "w":r=new Date(r.getFullYear(),r.getMonth(),r.getDate());q=new Date(q.getFullYear(),q.getMonth(),q.getDate());break;case "h":r=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours());q=new Date(q.getFullYear(),q.getMonth(),q.getDate(),q.getHours());break;case "n":r=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes());q=new Date(q.getFullYear(),q.getMonth(),q.getDate(),q.getHours(),
q.getMinutes());break;case "s":r=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds());q=new Date(q.getFullYear(),q.getMonth(),q.getDate(),q.getHours(),q.getMinutes(),q.getSeconds())}var y=r.getTime(),J=q.getTime(),C=NaN;switch(g){case "y":C=q.getFullYear()-r.getFullYear();break;case "m":C=(q.getFullYear()-r.getFullYear())*12+q.getMonth()-r.getMonth();break;case "d":C=Math.floor(J/864E5)-Math.floor(y/864E5);break;case "w":C=Math.floor((J+3456E5)/6048E5)-Math.floor((y+
3456E5)/6048E5);break;case "h":C=Math.floor(J/36E5)-Math.floor(y/36E5);break;case "n":C=Math.floor(J/6E4)-Math.floor(y/6E4);break;case "s":C=Math.floor(J/1E3)-Math.floor(y/1E3);break;case "l":C=J-y}return C};if(j.fn.noSelect==undefined)j.fn.noSelect=function(g){return(prevent=g==null?true:g)?this.each(function(){if(j.browser.msie||j.browser.safari)j(this).bind("selectstart",function(){return false});else if(j.browser.mozilla){j(this).css("MozUserSelect","none");j("body").trigger("focus")}else j.browser.opera?
j(this).bind("mousedown",function(){return false}):j(this).attr("unselectable","on")}):this.each(function(){if(j.browser.msie||j.browser.safari)j(this).unbind("selectstart");else if(j.browser.mozilla)j(this).css("MozUserSelect","inherit");else j.browser.opera?j(this).unbind("mousedown"):j(this).removeAttr("unselectable","on")})};j.fn.bcalendar=function(g){function r(c,a){var h=g.loadDateR.length;a||(a=c);if(h==0)g.loadDateR.push({startdate:c,enddate:a});else{for(var d=0;d<h;d++){var f=g.loadDateR[d],
e=A("d",c,f.startdate);if(e==0||e==1){if(f.enddate<a)f.enddate=a;break}else if(e>1){e=A("d",a,f.startdate);if(e>1)g.loadDateR.splice(0,0,{startdate:c,enddate:a});else{f.startdate=c;if(f.enddate<a)f.enddate=a}break}else{e=A("d",a,f.startdate);if(f.enddate<a)if(e<1){f.enddate=a;break}else d==h-1&&g.loadDateR.push({startdate:c,enddate:a})}}h=g.loadDateR.length;if(h>1)for(d=0;d<h-1;){f=g.loadDateR[d];e=g.loadDateR[d+1];if(A("d",e.startdate,f.enddate)<=1){f.startdate=e.startdate>f.startdate?f.startdate:
e.startdate;f.enddate=e.enddate>f.enddate?e.enddate:f.enddate;g.loadDateR.splice(d+1,1);h--}else d++}}}function q(){var c=new Date(g.showday.getFullYear(),g.showday.getMonth(),g.showday.getDate()),a=g.eventItems,h={view:g.view,weekstartday:g.weekstartday,theme:g.theme};if(g.view=="day"||g.view=="week"){var d=j("#dvtec");if(d.length>0)g.scoll=d.attr("scrollTop")}switch(g.view){case "day":y(c,1,a,h);break;case "week":y(c,7,a,h);break;case "month":d=[];d.push('<div id="mvcontainer" class="mv-container">');
d.push('<table id="mvweek" class="mv-daynames-table" cellSpacing="0" cellPadding="0"><tbody><tr>');for(var f=h.weekstartday,e=0;e<7;f++,e++){if(f>6)f=0;d.push('<th class="mv-dayname" title="',Q[f],'">',Q[f],"")}d.push("</tr></tbody></table>");d.push("</div>");f=g.height-21;d.push('<div id="mvEventContainer" class="mv-event-container" style="height:',f,"px;",'">');var i=h.weekstartday;e=f;f=new Date(c.getFullYear(),c.getMonth(),1);var l=i-f.getDay();h=c.getMonth();if(l>0)l-=7;var m=z("d",l,f),n=z("d",
34,m);f=5;if(n.getFullYear()==c.getFullYear()&&n.getMonth()==c.getMonth()&&n.getDate()<xa[h]){n=z("d",7,n);f=6}g.vstart=m;g.vend=n;g.datestrshow=Z(m,n);e-=18*f;e/=f;c=parseInt(e/21);e%21>15&&c++;e=100/f;l=[];for(var k={},p=a.length,u=0;u<p;u++){var o=a[u][2],t=a[u][3],x=A("d",o,t),v={};v.event=a[u];v.day=o.getDate();v.year=o.getFullYear();v.month=o.getMonth()+1;v.allday=a[u][4]==1;v.crossday=a[u][5]==1;v.reevent=a[u][6]==1;v.daystr=v.year+"/"+v.month+"/"+v.day;v.st={};v.st.hour=o.getHours();v.st.minute=
o.getMinutes();v.st.p=v.st.hour*60+v.st.minute;v.et={};v.et.hour=t.getHours();v.et.minute=t.getMinutes();v.et.p=v.et.hour*60+v.et.minute;if(x>0){if(o<m)o=m;if(t>n)t=n;x=i-o.getDay();if(x>0)x-=7;for(x=z("d",x,o);x<=t;o=x=z("d",7,x)){var L=Y(v),G=s.call(o,i18n.xgcalendar.dateformat.fulldaykey),B=A("d",x,t);if(k[G]==null)k[G]=[];L.colSpan=B>=7?7-A("d",x,o):A("d",o,t)+1;k[G].push(L)}}else{G=s.call(a[u][2],i18n.xgcalendar.dateformat.fulldaykey);if(k[G]==null)k[G]=[];v.colSpan=1;k[G].push(v)}}a=[];i=[];
for(n=0;n<f;n++){u=0;l[n]=b=[];for(p=0;p<7;p++){o=z("d",n*7+p,m);i[n*7+p]=o;o=s.call(o,i18n.xgcalendar.dateformat.fulldaykey);b[p]=k[o];if(b[p]&&b[p].length>0)u+=b[p].length}a[n]=u}ha.data("mvdata",l);for(n=0;n<f;n++){d.push("<div id='mvrow_",n,"' style=\"HEIGHT:",e,"%; TOP:",e*n,'%"  class="month-row">');d.push('<table class="st-bg-table" cellSpacing="0" cellPadding="0"><tbody><tr>');u=a[n];for(p=0;p<7;p++){m=i[n*7+p];d.push("<td abbr='",s.call(m,i18n.xgcalendar.dateformat.fulldayvalue),"' ch='qkadd' axis='00:00' title=''");
s.call(m,"yyyyMMdd")==s.call(new Date,"yyyyMMdd")?d.push(' class="st-bg st-bg-today">'):d.push(' class="st-bg">');d.push("&nbsp;</td>")}d.push("</tr></tbody></table>");d.push('<table class="st-grid" cellpadding="0" cellspacing="0"><tbody>');d.push("<tr>");for(p=0;p<7;p++){k={titleClass:"",dayshow:""};m=i[n*7+p];if(s.call(m,"yyyyMMdd")==s.call(new Date,"yyyyMMdd"))k.titleClass=" st-dtitle-today";if(m.getMonth()!=h)k.titleClass=" st-dtitle-nonmonth";k.title=s.call(m,i18n.xgcalendar.dateformat.fulldayshow);
k.dayshow=m.getDate()==1?m.getMonth==0?s.call(m,i18n.xgcalendar.dateformat.fulldayshow):s.call(m,i18n.xgcalendar.dateformat.Md3):m.getDate();k.abbr=s.call(m,i18n.xgcalendar.dateformat.fulldayvalue);d.push(M("<td class=\"st-dtitle${titleClass}\" ch='qkadd' abbr='${abbr}' axis='00:00' title=\"${title}\"><span class='monthdayshow'>${dayshow}</span></a></td>",k))}d.push("</tr>");m=d;k=l[n];p=u;u=c;var D=i[n*7];o=[];t=[];v=[];x=[];L=k.length;for(B=G=0;B<L;B++){o.push(0);t.push(0);v.push(0);x.push(z("d",
B,D))}for(B=0;B<L;B++){var w=k[B]?k[B].length:0;t[B]+=w;for(var E=0;E<w;E++)if((D=k[B][E])&&D.colSpan>1)for(var H=1;H<D.colSpan;H++)t[B+H]++}for(B=0;B<u&&G<p;B++){m.push("<tr>");for(w=0;w<L;){D=k[w]?k[w][o[w]]:undefined;E={"class":"",axis:"",ch:"",title:"",abbr:"",html:"",otherAttr:"",click:"javascript:void(0);"};var $=["st-c"];if(D){o[w]+=1;H=false;if(v[w]+1==t[w]&&D.colSpan==1)H=true;if(!H&&B==u-1&&v[w]<t[w]){G++;j.extend(E,{axis:w,ch:"more",abbr:s.call(x[w],i18n.xgcalendar.dateformat.fulldayvalue),
html:i18n.xgcalendar.others+(t[w]-v[w])+i18n.xgcalendar.item,click:"javascript:alert('more event');"});$.push("st-more st-moreul");w++}else{E.html=ia(D,x[w],L-w);E.ch="show";if(D.colSpan>1){E.otherAttr=" colSpan='"+D.colSpan+"'";for(H=0;H<D.colSpan;H++)v[w+H]+=1;w+=D.colSpan}else{v[w]+=1;w++}G++}}else{if(B==u-1&&v[w]<t[w]&&t[w]>0){j.extend(E,{axis:w,ch:"more",abbr:s.call(x[w],i18n.xgcalendar.dateformat.fulldayvalue),html:i18n.xgcalendar.others+(t[w]-v[w])+i18n.xgcalendar.item,click:"javascript:alert('more event');"});
$.push("st-more st-moreul")}else{j.extend(E,{html:"&nbsp;",ch:"qkadd",axis:"00:00",abbr:s.call(x[w],i18n.xgcalendar.dateformat.fulldayvalue),title:""});$.push("st-s")}w++}E.cssclass=$.join(" ");m.push(M("<td class='${cssclass}' axis='${axis}' ch='${ch}' abbr='${abbr}' title='${title}' ${otherAttr}>${html}</td>",E))}m.push("</tr>")}d.push("</tbody></table>");d.push("</div>")}d.push("</div>");I.html(d.join(""));j("#cal-month-closebtn").click(J);break;default:alert(i18n.xgcalendar.no_implement)}ya(g.view);
d=g.view;if(d=="day"||d=="week"){h=j("#dvwkcontaienr");d=j("#dvtec");if(h.length==0||d.length==0)alert(i18n.xgcalendar.view_no_ready);else{h=h.height()+2;d.height(g.height-8-h);if(typeof g.scoll=="undefined"){f=new Date;h=f.getHours();f=f.getMinutes();c=K(h,f);f=d.attr("clientHeight");c-=0.5*f;e=d.attr("scrollHeight");if(c<0)c=0;if(c>e-f)c=e-f-10*(23-h);d.attr("scrollTop",c)}else d.attr("scrollTop",g.scoll)}}}function y(c,a,h,d){var f=[];if(a==1){d=s.call(c,i18n.xgcalendar.dateformat.Md);f.push({display:d,
date:c,day:c.getDate(),year:c.getFullYear(),month:c.getMonth()+1});g.datestrshow=Z(f[0].date);g.vstart=f[0].date;g.vend=f[0].date}else{var e=0;if(a==7){e=d.weekstartday-c.getDay();if(e>0)e-=7}for(var i=e,l=0;l<a;i+=1,l++){e=z("d",i,c);d=s.call(e,i18n.xgcalendar.dateformat.Md);f.push({display:d,date:e,day:e.getDate(),year:e.getFullYear(),month:e.getMonth()+1})}g.vstart=f[0].date;g.vend=f[a-1].date;g.datestrshow=Z(f[0].date,f[a-1].date)}a=[];c=[];d=f.length;i=h.length;l=[];for(e=0;e<i;e++){var m=h[e][2],
n=h[e][3],k={};k.event=h[e];k.day=m.getDate();k.year=m.getFullYear();k.month=m.getMonth()+1;k.allday=h[e][4]==1;k.crossday=h[e][5]==1;k.reevent=h[e][6]==1;k.daystr=[k.year,k.month,k.day].join("/");k.st={};k.st.hour=m.getHours();k.st.minute=m.getMinutes();k.st.p=k.st.hour*60+k.st.minute;k.et={};k.et.hour=n.getHours();k.et.minute=n.getMinutes();k.et.p=k.et.hour*60+k.et.minute;l.push(k)}for(i=h=0;i<d;i++){m=f[i];c[i]=[];a[i]=[];m.daystr=m.year+"/"+m.month+"/"+m.day;for(e=0;e<l.length;e++)if(!l[e].crossday&&
!l[e].allday)m.daystr==l[e].daystr&&c[i].push(l[e]);else if(m.daystr==l[e].daystr){a[i].push(l[e]);h++}else if(i==0&&m.date>=l[e].event[2]&&m.date<=l[e].event[3]){a[i].push(l[e]);h++}}l=f[d-1].date;for(i=0;i<d;i++){k=a[i];if(k.length>0)for(e=0;e<k.length;e++){m=A("d",l,k[e].event[3])>0?l:k[e].event[3];k[e].colSpan=A("d",f[i].date,m)+1}}for(i=0;i<d;i++){k=c[i];if(k.length>0){l=[];m=[];var p=[],u=k.length,o;for(e=0;e<u;++e){var t=k[e],x=t.st.p;for(o=0;m[o]>x;)o++;t.PO=o;t.ne=[];m[o]=t.et.p||1440;l[o]=
t;p[o]||(p[o]=[]);p[o].push(t);if(o!=0){t.pe=[l[o-1]];l[o-1].ne.push(t)}for(o+=1;m[o]<=x;)o++;if(l[o]){n=l[o];t.ne.push(n);n.pe.push(t)}t.width=1/(t.PO+1);t.left=1-t.width}n=Array.prototype.concat.apply([],p);for(m=e=n.length;m--;){k=1;x=0;l=n[m];for(p=l.ne.length;p--;){o=l.ne[p];x=Math.max(x,o.VL);k=Math.min(k,o.left)}l.VL=x+1;l.width=k/(l.PO+1);l.left=k-l.width}for(m=0;m<e;m++){l=n[m];l.left=0;if(l.pe)for(p=l.pe.length;p--;){k=l.pe[p];l.left=Math.max(l.left,k.left+k.width)}k=(1-l.left)/l.VL;l.width=
Math.max(l.width,k);l.aQ=Math.min(1-l.left,l.width+0.7*k)}c[i]=n}}e=h;d=[];d.push('<div id="dvwkcontaienr" class="wktopcontainer">');d.push('<table class="wk-top" border="0" cellpadding="0" cellspacing="0">');d.push("<tr>",'<th width="60" rowspan="3">&nbsp;</th>');for(h=0;h<f.length;h++){if(f.length==1)m=l=i="";else{i="";l=i18n.xgcalendar.to_date_view;m="wk-daylink"}d.push("<th abbr='",s.call(f[h].date,i18n.xgcalendar.dateformat.fulldayvalue),"' class='gcweekname' scope=\"col\"><div title='",l,"' ",
i," class='wk-dayname'><span class='",m,"'>",f[h].display,"</span></div></th>")}d.push('<th width="16" rowspan="3">&nbsp;</th>');d.push("</tr>");d.push("<tr>");d.push('<td class="wk-allday"');f.length>1&&d.push(" colSpan='",f.length,"'");d.push('><div id="weekViewAllDaywk" ><table class="st-grid" cellpadding="0" cellspacing="0"><tbody>');if(e==0){d.push("<tr>");for(h=0;h<f.length;h++)d.push('<td class="st-c st-s"'," ch='qkadd' abbr='",s.call(f[h].date,"yyyy-M-d"),"' axis='00:00'>&nbsp;</td>")}else{h=
a.length;i=0;l=[];for(m=0;m<h;m++)l.push(0);for(m=0;i<e;m++){d.push("<tr>");for(n=0;n<h;){k=a[n][l[n]];d.push("<td class='st-c");if(k){l[n]+=1;d.push("'");p=ia(k,f[n].date,h-n);if(k.colSpan>1){d.push(" colSpan='",k.colSpan,"'");n+=k.colSpan}else n++;d.push(" ch='show'>",p);i++}else{d.push(" st-s' ch='qkadd' abbr='",s.call(f[n].date,i18n.xgcalendar.dateformat.fulldayvalue),"' axis='00:00'>&nbsp;");n++}d.push("</td>")}d.push("</tr>")}d.push("<tr>");for(n=0;n<h;n++)d.push("<td class='st-c st-s' ch='qkadd' abbr='",
s.call(f[n].date,i18n.xgcalendar.dateformat.fulldayvalue),"' axis='00:00'>&nbsp;</td>")}d.push("</tr>");d.push("</tbody></table></div></td></tr>");d.push("<tr>");d.push('<td style="height: 5px;"');f.length>1&&d.push(" colSpan='",f.length,"'");d.push("></td>");d.push("</tr>");d.push("</table>");d.push("</div>");d.push('<div id="dvtec"  class="scolltimeevent"><table style="table-layout: fixed;',jQuery.browser.msie?"":"width:100%",'" cellspacing="0" cellpadding="0"><tbody><tr><td>');d.push('<table style="height: 1008px" id="tgTable" class="tg-timedevents" cellspacing="0" cellpadding="0"><tbody>');
d.push("<tr>");d.push("<td style='width:60px;'></td>");d.push("<td");f.length>1&&d.push(" colSpan='",f.length,"'");d.push('><div id="tgspanningwrapper" class="tg-spanningwrapper"><div style="font-size: 20px" class="tg-hourmarkers">');for(a=0;a<24;a++)d.push('<div class="tg-dualmarker"></div>');d.push("</div></div></td></tr>");d.push("<tr>");d.push('<td style="width: 60px" class="tg-times">');e=new Date;a=e.getHours();e=e.getMinutes();e=K(a,e)-4;d.push('<div id="tgnowptr" class="tg-nowptr" style="left:0px;top:',
e,'px"></div>');h="";for(a=0;a<24;a++){h=aa(a,0,g.tgtimeFormat);d.push('<div style="height: 41px" class="tg-time">',h,"</div>")}d.push("</td>");h=f.length;for(a=0;a<h;a++){d.push("<td class=\"tg-col\" ch='qkadd' abbr='",s.call(f[a].date,i18n.xgcalendar.dateformat.fulldayvalue),"'>");(i=s.call(f[a].date,"yyyyMMdd")==s.call(new Date,"yyyyMMdd"))&&d.push('<div style="margin-bottom: -1008px; height:1008px" class="tg-today">&nbsp;</div>');d.push('<div  style="margin-bottom: -1008px; height: 1008px" id=\'tgCol',
a,'\' class="tg-col-eventwrapper">');l=d;m=c[a];for(n=0;n<m.length;n++){o=m[n].event[7]&&m[n].event[7]>=0?R(m[n].event[7]):R();k=m[n];p=n;o={bdcolor:o[0],bgcolor2:o[0],bgcolor1:o[2],width:"70%",icon:"",title:"",data:""};o.starttime=aa(k.st.hour,k.st.minute,g.timeFormat);o.endtime=aa(k.et.hour,k.et.minute,g.timeFormat);o.content=k.event[1];o.title=C(k.event);o.data=k.event.join("$");x=[];x.push('<I class="cic cic-tmr">&nbsp;</I>');k.reevent&&x.push('<I class="cic cic-spcl">&nbsp;</I>');o.icon=x.join("");
x=K(k.st.hour,k.st.minute);u=K(k.et.hour,k.et.minute);o.top=x+"px";o.left=k.left*100+"%";o.width=k.aQ*100+"%";o.height=u-x-4;o.i=p;if(g.enableDrag&&k.event[8]==1){o.drag="drag";o.redisplay="block"}else{o.drag="";o.redisplay="none"}k=M(na,o);l.push(k)}d.push("</div>");d.push('<div class="tg-col-overlaywrapper" id=\'tgOver',a,"'>");i&&d.push('<div id="tgnowmarker" class="tg-hourmarker tg-nowmarker" style="left:0px;top:',e+4,'px"></div>');d.push("</div>");d.push("</td>")}d.push("</tr>");d.push("</tbody></table></td></tr></tbody></table></div>");
I.html(d.join(""))}function J(){j("#cal-month-cc").css("display","none")}function C(c){var a,h,d,f;h=c[4]!=1;f=c[1];a=T(c[2],null,h,true);h=T(c[3],c[2],h,true);a=s.call(c[2],a)+" - "+s.call(c[3],h);h=c[9]!=undefined&&c[9]!=""?c[9]:i18n.xgcalendar.i_undefined;d=c[10]!=undefined&&c[10]!=""?c[10]:"";var e=[];if(c[4]==1)e.push("["+i18n.xgcalendar.allday_event+"]",j.browser.mozilla?"":"\r\n");else if(c[5]==1)e.push("["+i18n.xgcalendar.repeat_event+"]",j.browser.mozilla?"":"\r\n");e.push(i18n.xgcalendar.time+
":",a,j.browser.mozilla?"":"\r\n",i18n.xgcalendar.event+":",f,j.browser.mozilla?"":"\r\n",i18n.xgcalendar.location+":",h);if(d!="")e.push(j.browser.mozilla?"":"\r\n",i18n.xgcalendar.participant+":",d);return e.join("")}function ia(c,a,h){var d={color:(c.event[7]&&c.event[7]>=0?R(c.event[7]):R())[2],title:"",extendClass:"",extendHTML:"",data:""};d.title=C(c.event);d.id="bbit_cal_event_"+c.event[0];d.eclass=g.enableDrag&&c.event[8]==1?"drag":"cal_"+c.event[0];d.data=c.event.join("$");var f=[],e=c.event[2]<
a;a=A("d",a,c.event[3])>=h;if(e||a){if(e){f.push('<div class="st-ad-ml"></div>');d.extendClass="st-ad-mpad "}a&&f.push('<div class="st-ad-mr"></div>');d.extendHTML=f.join("")}f=!c.allday&&!e?aa(c.st.hour,c.st.minute,g.timeFormat)+" "+c.event[1]:c.event[1];e=[];e.push(M('<span style="cursor: pointer">${content}</span>',{content:f}));e.push('<I class="cic cic-tmr">&nbsp;</I>');c.reevent&&e.push('<I class="cic cic-rcr">&nbsp;</I>');d.content=e.join("");return M(za,d)}function ja(){if(g.isloading)return true;
if(g.url&&g.url!=""){g.isloading=true;if(g.onBeforeRequestData&&j.isFunction(g.onBeforeRequestData))g.onBeforeRequestData(1);var c=(new Date).getTimezoneOffset()/60*-1;c=[{name:"showdate",value:s.call(g.showday,i18n.xgcalendar.dateformat.fulldayvalue)},{name:"viewtype",value:g.view},{name:"timezone",value:c}];if(g.extParam)for(var a=0;a<g.extParam.length;a++)c[c.length]=g.extParam[a];j.ajax({type:g.method,url:g.url,data:c,dataType:"json",dataFilter:function(h){return h.replace(/"\\\/(Date\([0-9-]+\))\\\/"/gi,
"new $1")},success:function(h){if(h!=null&&h.error!=null){if(g.onRequestDataError)g.onRequestDataError(1,h)}else{Aa(h,h.start,h.end);r(h.start,h.end)}if(g.onAfterRequestData&&j.isFunction(g.onAfterRequestData))g.onAfterRequestData(1);g.isloading=false},error:function(h){try{if(g.onRequestDataError)g.onRequestDataError(1,h);else alert(i18n.xgcalendar.get_data_exception);if(g.onAfterRequestData&&j.isFunction(g.onAfterRequestData))g.onAfterRequestData(1);g.isloading=false}catch(d){}}})}else alert("url"+
i18n.xgcalendar.i_undefined)}function Aa(c,a,h){c=c.issort==false?c.events&&c.events.length>0?c.sort(function(d,f){return d[2]>f[2]?-1:1}):[]:c.events;Ba(c,a,h);q()}function Ba(c,a,h){c||(c=[]);if(c)if(g.eventItems.length==0)g.eventItems=c;else{var d=c,f=d.length;if(f>0)for(var e=d[0][2],i=d[f-1][2],l=0,m=g.eventItems.length;l<m;l++){if(g.eventItems[l][2]>i||f==0)break;if(g.eventItems[l][2]>=e)for(var n=0;n<f;n++)if(g.eventItems[l][0]==d[n][0]&&g.eventItems[l][2]<a){d.splice(n,1);f--;break}}d=g.eventItems.length;
e=-1;f=d;if(g.eventItems[0][2]>h)g.eventItems=c.concat(g.eventItems);else if(g.eventItems[d-1][2]<a)g.eventItems=g.eventItems.concat(c);else{for(i=0;i<d;i++)if(g.eventItems[i][2]>=a&&e<0)e=i;else if(g.eventItems[i][2]>h){f=i;break}a=e<=0?[]:g.eventItems.slice(0,e);h=f==d?[]:g.eventItems.slice(f);g.eventItems=[].concat(a,c,h)}}}function oa(){var c=j(this).attr("abbr");g.showday=U(c+" 00:00");g.view="day";q();if(g.onWeekOrMonthToDay)g.onWeekOrMonthToDay(g);return false}function K(c,a){return c*42+parseInt(a/
60*42)}function ba(c,a){var h=c/42,d=parseInt(h);h=h-d>=0.5?30:0;var f=a/42,e=parseInt(f);return{sh:d,sm:h,eh:e,em:f-e>=0.5?30:0,h:a-c}}function pa(c,a,h){var d=Math.min(c,a);c=Math.max(c,a);var f=(d-h)/42;a=parseInt(f);f=f-a>=0.5?30:0;h=(c-h)/42;var e=parseInt(h);return{sh:a,sm:f,eh:e,em:h-e>=0.5?30:0,h:c-d}}function ca(c){return c<10?"0"+c:""+c}function R(c){function a(h,d){return"#"+"666666888888aaaaaabbbbbbdddddda32929cc3333d96666e69999f0c2c2b1365fdd4477e67399eea2bbf5c7d67a367a994499b373b3cca2cce1c7e15229a36633cc8c66d9b399e6d1c2f029527a336699668cb399b3ccc2d1e12952a33366cc668cd999b3e6c2d1f01b887a22aa9959bfb391d5ccbde6e128754e32926265ad8999c9b1c2dfd00d78131096184cb05288cb8cb8e0ba52880066aa008cbf40b3d580d1e6b388880eaaaa11bfbf4dd5d588e6e6b8ab8b00d6ae00e0c240ebd780f3e7b3be6d00ee8800f2a640f7c480fadcb3b1440edd5511e6804deeaa88f5ccb8865a5aa87070be9494d4b8b8e5d4d47057708c6d8ca992a9c6b6c6ddd3dd4e5d6c6274878997a5b1bac3d0d6db5a69867083a894a2beb8c1d4d4dae54a716c5c8d8785aaa5aec6c3cedddb6e6e41898951a7a77dc4c4a8dcdccb8d6f47b08b59c4a883d8c5ace7dcce".substring(h*
30+d*6,h*30+(d+1)*6)}c=c!=null&&c!=undefined?c:g.theme;return[a(c,0),a(c,1),a(c,2),a(c,3)]}function M(c,a){return c.replace(/\$\{([\w]+)\}/g,function(h,d){var f=a[d];return typeof f!="undefined"?f:h})}function aa(c,a,h){c={"h+":c>12?c-12:c,"H+":c,"m+":a,"s+":0,t:c<12?i18n.xgcalendar.dateformat.AM:i18n.xgcalendar.dateformat.PM};for(var d in c)if(RegExp("("+d+")").test(h))h=h.replace(RegExp.$1,RegExp.$1.length==1?c[d]:("00"+c[d]).substr((""+c[d]).length));return h}function T(c,a,h,d){var f=h!=undefined?
c.getFullYear()!=(new Date).getFullYear():true,e=true,i=true;h=h||false;d=d||false;if(a){f=a.getFullYear()!=c.getFullYear();if(a.getFullYear()==c.getFullYear()&&c.getMonth()==a.getMonth()&&c.getDate()==a.getDate())f=e=i=d=false}c=[];if(f)c.push(i18n.xgcalendar.dateformat.fulldayshow);else if(e)c.push(i18n.xgcalendar.dateformat.Md3);else i&&c.push(i18n.xgcalendar.dateformat.day);c.push(d?" (W)":"",h?g.timeFormat:"");return c.join("")}function Z(c,a,h,d){if(a){var f=s.call(c,T(c,null,h,d));c=s.call(a,
T(a,c,h,d));return[f,c].join(c!=""?" - ":"")}else return s.call(c,T(c,null,h))}function da(){var c={start:g.vstart,end:g.vend},a;a=c.start;c=c.end;var h=g.loadDateR.length;if(h==0)a=false;else{for(var d=false,f=false,e=0;e<h;e++){f=d=false;var i=g.loadDateR[e];if(a>=i.startdate&&a<=i.enddate)d=true;if(s.call(a,"yyyyMMdd")==s.call(i.startdate,"yyyyMMdd")||s.call(a,"yyyyMMdd")==s.call(i.enddate,"yyyyMMdd"))d=true;if(c){if(c>=i.startdate&&c<=i.enddate)f=true;if(s.call(c,"yyyyMMdd")==s.call(i.startdate,
"yyyyMMdd")||s.call(c,"yyyyMMdd")==s.call(i.enddate,"yyyyMMdd"))f=true}else f=true;if(d&&f)break}a=d&&f}a||ja()}function N(c,a,h,d,f,e,i,l,m){m=m!=undefined&&m>=0?R(m):R();return M(na,{bdcolor:m[0],bgcolor2:m[0],bgcolor1:m[2],data:"",starttime:[ca(c),ca(a)].join(":"),endtime:[ca(h),ca(d)].join(":"),content:e?e:i18n.xgcalendar.new_event,title:e?e:i18n.xgcalendar.new_event,icon:'<I class="cic cic-tmr">&nbsp;</I>',top:"0px",left:"",width:i?i:"100%",height:f-4,i:"-1",drag:"drag-chip",redisplay:l?"block":
"none"})}function V(c){c=c.find("div.dhdV");if(c.length==1){c=c.text().split("$");if(c.length>6){var a=[];a.push(c[0],c[1],new Date(c[2]),new Date(c[3]),parseInt(c[4]),parseInt(c[5]),parseInt(c[6]),c[7]!=undefined?parseInt(c[7]):-1,c[8]!=undefined?parseInt(c[8]):0,c[9],c[10]);c=a}else c=null;return c}return null}function qa(c){j("#bbit-cs-buddle").css("visibility","hidden");var a=j("#bbit-cs-id").val();c=[{name:"calendarId",value:a},{name:"type",value:c}];var h=ka(a,true);g.onBeforeRequestData&&g.onBeforeRequestData(3);
j.post(g.quickDeleteUrl,c,function(d){if(d){if(d.IsSuccess)h=null;else{g.onRequestDataError&&g.onRequestDataError(3,d);ea(h);q()}g.onAfterRequestData&&g.onAfterRequestData(3)}},"json");q()}function ra(c,a){var h=c-110,d=a-217,f=document.documentElement.clientWidth,e=document.documentElement.clientHeight,i=false;if(h<=0||d<=0||h+400>f){h=c-200<=0?10:c-200;d=a-159<=0?10:a-159;if(h+400>=f)h=f-410;if(d+164>=e)d=e-165;i=true}return{left:h,top:d,hide:i}}function fa(c,a){if(a==undefined)a=V(j(this));if(a!=
null)if(g.quickDeleteUrl!=""&&a[8]==1&&g.readonly!=true){var h='<div id="bbit-cs-buddle" style="z-index: 180; width: 400px;visibility:hidden;" class="bubble"><table class="bubble-table" cellSpacing="0" cellPadding="0"><tbody><tr><td class="bubble-cell-side"><div id="tl1" class="bubble-corner"><div class="bubble-sprite bubble-tl"></div></div><td class="bubble-cell-main"><div class="bubble-top"></div><td class="bubble-cell-side"><div id="tr1" class="bubble-corner"><div class="bubble-sprite bubble-tr"></div></div>  <tr><td class="bubble-mid" colSpan="3"><div style="overflow: hidden" id="bubbleContent1"><div><div></div><div class="cb-root"><table class="cb-table" cellSpacing="0" cellPadding="0"><tbody><tr><td class="cb-value"><div class="textbox-fill-wrapper"><div class="textbox-fill-mid"><div id="bbit-cs-what" title="'+
i18n.xgcalendar.click_to_detail+'" class="textbox-fill-div lk" style="cursor:pointer;"></div></div></div></td></tr><tr><td class=cb-value><div id="bbit-cs-buddle-timeshow"></div></td></tr></tbody></table><div class="bbit-cs-split"><input id="bbit-cs-id" type="hidden" value=""/>[ <span id="bbit-cs-delete" class="lk">'+i18n.xgcalendar.i_delete+'</span> ]&nbsp; <SPAN id="bbit-cs-editLink" class="lk">'+i18n.xgcalendar.update_detail+' <StrONG>\u00bb</StrONG></SPAN></div></div></div></div><tr><td><div id="bl1" class="bubble-corner"><div class="bubble-sprite bubble-bl"></div></div><td><div class="bubble-bottom"></div><td><div id="br1" class="bubble-corner"><div class="bubble-sprite bubble-br"></div></div></tr></tbody></table><div id="bubbleClose2" class="bubble-closebutton"></div><div id="prong1" class="prong"><div class=bubble-sprite></div></div></div>',
d=j("#bbit-cs-buddle");if(d.length==0){d=j(h).appendTo(document.body);h=j("#bbit-cs-delete");var f=j("#bbit-cs-editLink");j("#bubbleClose2").click(function(){j("#bbit-cs-buddle").css("visibility","hidden")});h.click(function(){var i=j("#bbit-cs-buddle").data("cdata");if(g.DeleteCmdhandler&&j.isFunction(g.DeleteCmdhandler))g.DeleteCmdhandler.call(this,i,qa);else if(confirm(i18n.xgcalendar.confirm_delete_event+"?")){var l=0;l=i[6]==1?confirm(i18n.xgcalendar.confrim_delete_event_or_all)?0:1:0;qa(l)}});
j("#bbit-cs-what").click(function(){if(g.ViewCmdhandler)g.ViewCmdhandler&&j.isFunction(g.ViewCmdhandler)&&g.ViewCmdhandler.call(this,j("#bbit-cs-buddle").data("cdata"));else alert("ViewCmdhandler"+i18n.xgcalendar.i_undefined);j("#bbit-cs-buddle").css("visibility","hidden");return false});f.click(function(){if(g.EditCmdhandler)g.EditCmdhandler&&j.isFunction(g.EditCmdhandler)&&g.EditCmdhandler.call(this,j("#bbit-cs-buddle").data("cdata"));else alert("EditCmdhandler"+i18n.xgcalendar.i_undefined);j("#bbit-cs-buddle").css("visibility",
"hidden");return false});d.click(function(){return false})}h=ra(c.pageX,c.pageY);h.hide?j("#prong1").hide():j("#prong1").show();f=[];var e=A("d",a[2],a[3])!=0;f.push(s.call(a[2],i18n.xgcalendar.dateformat.Md3)," (",Q[a[2].getDay()],")");a[4]!=1&&f.push(",",s.call(a[2],g.timeFormat));if(e){f.push(" - ",s.call(a[3],i18n.xgcalendar.dateformat.Md3)," (",Q[a[3].getDay()],")");a[4]!=1&&f.push(",",s.call(a[3],g.timeFormat))}j("#bbit-cs-buddle-timeshow").html(f.join(""));j("#bbit-cs-what").html(a[1]);j("#bbit-cs-id").val(a[0]);
d.data("cdata",a);d.css({visibility:"visible",left:h.left,top:h.top});j(document).one("click",function(){j("#bbit-cs-buddle").css("visibility","hidden")})}else if(g.ViewCmdhandler)g.ViewCmdhandler&&j.isFunction(g.ViewCmdhandler)&&g.ViewCmdhandler.call(this,a);else alert("ViewCmdhandler"+i18n.xgcalendar.i_undefined);else alert(i18n.xgcalendar.data_format_error);return false}function Ca(c){var a=j(this),h=c.id.split("_")[1],d=j(c);c=a.position();var f=d.position();d=(a.width()+2)*1.5;f=f.top+15;var e=
c.left,i=this.abbr.split(i18n.xgcalendar.dateformat.separator),l=new Date(i[0],parseInt(i[1]-1),i[2]);i=j("#cal-month-cc");var m=j("#cal-month-cc-content table tbody");j("#cal-month-cc-title").html(s.call(l,i18n.xgcalendar.dateformat.Md3)+" "+Q[l.getDay()]);m.empty();var n=j("#gridEvent").data("mvdata");h=n[h];n=parseInt(this.axis);for(var k=[],p=0;p<=n;p++)for(var u=h[p]?h[p].length:0,o=0;o<u;o++){var t=h[p][o];if(t)if(t.colSpan+p-1>=n){k.push("<tr><td class='st-c'>");k.push(ia(t,l,1));k.push("</td></tr>")}}m.html(k.join(""));
m.find("div.rb-o").each(function(){j(this).click(fa)});n=h=null;l=i.height();m=document.documentElement.clientHeight;if(e+d>=document.documentElement.clientWidth)e=c.left-(a.width()+2)*0.5;if(f+l>=m)f=m-l-10;if(e==0)e=10;i.css({left:e,top:f,"z-index":180,width:d,display:"block"});j(document).one("click",J);return false}function la(c,a,h){if(g.quickUpdateUrl!=""&&c[8]==1&&g.readonly!=true){if(g.isloading)return false;g.isloading=true;var d=c[0],f=c[2],e=c[3];c=(new Date).getTimezoneOffset()/60*-1;
c=[{name:"calendarId",value:d},{name:"CalendarStartTime",value:s.call(a,i18n.xgcalendar.dateformat.fulldayvalue+" HH:mm")},{name:"CalendarEndTime",value:s.call(h,i18n.xgcalendar.dateformat.fulldayvalue+" HH:mm")},{name:"timezone",value:c}];var i;if(g.quickUpdateHandler&&j.isFunction(g.quickUpdateHandler))g.quickUpdateHandler.call(this,c);else{g.onBeforeRequestData&&g.onBeforeRequestData(4);j.post(g.quickUpdateUrl,c,function(l){if(l){if(l.IsSuccess==true)g.isloading=false;else{g.onRequestDataError&&
g.onRequestDataError(4,l);g.isloading=false;i=ka(d,true);i[2]=f;i[3]=e;ea(i);q();i=null}g.onAfterRequestData&&g.onAfterRequestData(4)}},"json");if(i=ka(d,true)){i[2]=a;i[3]=h}ea(i);q()}}}function sa(c,a,h,d){if(!(!g.quickAddHandler&&g.quickAddUrl==""||g.readonly)){var f=j("#bbit-cal-buddle");if(f.length==0){f=[];f.push('<div id="bbit-cal-buddle" style="z-index: 180; width: 400px;visibility:hidden;" class="bubble">');f.push('<table class="bubble-table" cellSpacing="0" cellPadding="0"><tbody><tr><td class="bubble-cell-side"><div id="tl1" class="bubble-corner"><div class="bubble-sprite bubble-tl"></div></div>');
f.push('<td class="bubble-cell-main"><div class="bubble-top"></div><td class="bubble-cell-side"><div id="tr1" class="bubble-corner"><div class="bubble-sprite bubble-tr"></div></div>  <tr><td class="bubble-mid" colSpan="3"><div style="overflow: hidden" id="bubbleContent1"><div><div></div><div class="cb-root">');f.push('<table class="cb-table" cellSpacing="0" cellPadding="0"><tbody><tr><th class="cb-key">');f.push(i18n.xgcalendar.time,':</th><td class=cb-value><div id="bbit-cal-buddle-timeshow"></div></td></tr><tr><th class="cb-key">');
f.push(i18n.xgcalendar.content,':</th><td class="cb-value"><div class="textbox-fill-wrapper"><div class="textbox-fill-mid"><input id="bbit-cal-what" class="textbox-fill-input"/></div></div><div class="cb-example">');f.push(i18n.xgcalendar.example,'</div></td></tr></tbody></table><input id="bbit-cal-start" type="hidden"/><input id="bbit-cal-end" type="hidden"/><input id="bbit-cal-allday" type="hidden"/><input id="bbit-cal-quickAddBTN" value="');f.push(i18n.xgcalendar.create_event,'" type="button"/>&nbsp; <SPAN id="bbit-cal-editLink" class="lk">');
f.push(i18n.xgcalendar.update_detail,' <StrONG>\u00bb</StrONG></SPAN></div></div></div><tr><td><div id="bl1" class="bubble-corner"><div class="bubble-sprite bubble-bl"></div></div><td><div class="bubble-bottom"></div><td><div id="br1" class="bubble-corner"><div class="bubble-sprite bubble-br"></div></div></tr></tbody></table><div id="bubbleClose1" class="bubble-closebutton"></div><div id="prong2" class="prong"><div class=bubble-sprite></div></div></div>');var e=f.join("");f=null;j(document.body).append(e);
f=j("#bbit-cal-buddle");e=j("#bbit-cal-quickAddBTN");var i=j("#bbit-cal-editLink");j("#bubbleClose1").click(function(){j("#bbit-cal-buddle").css("visibility","hidden");S()});e.click(function(){if(g.isloading)return false;g.isloading=true;var l=j("#bbit-cal-what").val(),m=j("#bbit-cal-start").val(),n=j("#bbit-cal-end").val(),k=j("#bbit-cal-allday").val();if(!/^[^\$\<\>]+$/.test(l)){alert(i18n.xgcalendar.invalid_title);j("#bbit-cal-what").focus();return g.isloading=false}var p=(new Date).getTimezoneOffset()/
60*-1,u=[{name:"CalendarTitle",value:l},{name:"CalendarStartTime",value:m},{name:"CalendarEndTime",value:n},{name:"IsAllDayEvent",value:k},{name:"timezone",value:p}];if(g.extParam)for(p=0;p<g.extParam.length;p++)u[u.length]=g.extParam[p];if(g.quickAddHandler&&j.isFunction(g.quickAddHandler)){g.quickAddHandler.call(this,u);j("#bbit-cal-buddle").css("visibility","hidden");S()}else{j("#bbit-cal-buddle").css("visibility","hidden");p=[];var o=-1;g.onBeforeRequestData&&g.onBeforeRequestData(2);j.post(g.quickAddUrl,
u,function(t){if(t){if(t.IsSuccess==true){g.isloading=false;g.eventItems[o][0]=t.Data;g.eventItems[o][8]=1;q()}else{g.onRequestDataError&&g.onRequestDataError(2,t);g.isloading=false}g.onAfterRequestData&&g.onAfterRequestData(2)}},"json");p.push(-1,l);l=U(m);n=U(n);m=A("d",l,n);p.push(l,n,k=="1"?1:0,m>0?1:0,0);p.push(-1,0,"","");o=ea(p);S();q()}});i.click(function(){if(g.EditCmdhandler){g.EditCmdhandler&&j.isFunction(g.EditCmdhandler)&&g.EditCmdhandler.call(this,["0",j("#bbit-cal-what").val(),j("#bbit-cal-start").val(),
j("#bbit-cal-end").val(),j("#bbit-cal-allday").val()]);j("#bbit-cal-buddle").css("visibility","hidden");S()}else alert("EditCmdhandler"+i18n.xgcalendar.i_undefined);return false});f.mousedown(function(){return false})}e=Z(c,a,!h,true);d=ra(d.left,d.top);d.hide?j("#prong2").hide():j("#prong2").show();j("#bbit-cal-buddle-timeshow").html(e);e=j("#bbit-cal-what").val("");j("#bbit-cal-allday").val(h?"1":"0");j("#bbit-cal-start").val(s.call(c,i18n.xgcalendar.dateformat.fulldayvalue+" HH:mm"));j("#bbit-cal-end").val(s.call(a,
i18n.xgcalendar.dateformat.fulldayvalue+" HH:mm"));f.css({visibility:"visible",left:d.left,top:d.top});e.blur().focus();j(document).one("mousedown",function(){j("#bbit-cal-buddle").css("visibility","hidden");S()});return false}}function U(c){c=c.split(" ");var a=c[0].split(i18n.xgcalendar.dateformat.separator),h=c[1].split(":");c=a[i18n.xgcalendar.dateformat.year_index];var d=a[i18n.xgcalendar.dateformat.month_index].indexOf("0")==0?a[i18n.xgcalendar.dateformat.month_index].substr(1,1):a[i18n.xgcalendar.dateformat.month_index];
a=a[i18n.xgcalendar.dateformat.day_index].indexOf("0")==0?a[i18n.xgcalendar.dateformat.day_index].substr(1,1):a[i18n.xgcalendar.dateformat.day_index];var f=h[0].indexOf("0")==0?h[0].substr(1,1):h[0];h=h[1].indexOf("0")==0?h[1].substr(1,1):h[1];return new Date(c,parseInt(d)-1,a,f,h)}function ka(c,a){if(g.eventItems&&g.eventItems.length>0){for(var h=g.eventItems.length,d=-1,f=0;f<h;f++)if(g.eventItems[f][0]==c){d=f;break}if(d>=0){h=g.eventItems[d];a&&g.eventItems.splice(d,1);return h}}return null}function ea(c,
a){var h=0;if(a)h=1;else if(g.eventItems&&g.eventItems.length>0){var d=g.eventItems.length,f=c[2],e=f.getTime()-g.eventItems[0][2].getTime(),i=g.eventItems[d-1][2].getTime()-f.getTime();if(e<0||e-i<0)for(e=0;e<d;e++){if(g.eventItems[e][2]>=f){a=e;break}}else if(i<0)a=d;else if(e==i)a=d;else for(e=d-1;e>=0;e--)if(g.eventItems[e][2]<f){a=e+1;break}}else a=0;if(g.eventItems&&g.eventItems.length>0)a==g.eventItems.length?g.eventItems.push(c):g.eventItems.splice(a,h,c);else g.eventItems=[c];return a}function ma(){return false}
function ya(c){if(c=="week"||c=="day"){j("div.chip",I).each(function(){var a=j(this);a.click(fa);if(a.hasClass("drag")){a.mousedown(function(h){O.call(this,"dw3",h);return false});a.find("div.resizer").mousedown(function(h){O.call(j(this).parent().parent(),"dw4",h);return false})}else a.mousedown(ma)});j("div.rb-o",I).each(function(){var a=j(this);a.click(fa);a.hasClass("drag")&&c=="week"?a.mousedown(function(h){O.call(this,"dw5",h);return false}):a.mousedown(ma)});if(g.readonly==false){j("td.tg-col",
I).each(function(){j(this).mousedown(function(a){O.call(this,"dw1",a);return false})});j("#weekViewAllDaywk").mousedown(function(a){O.call(this,"dw2",a);return false})}c=="week"&&j("#dvwkcontaienr th.gcweekname").each(function(){j(this).click(oa)})}else{c="month";j("div.rb-o",I).each(function(){var a=j(this);a.click(fa);a.hasClass("drag")?a.mousedown(function(h){O.call(this,"m2",h);return false}):a.mousedown(ma)});j("td.st-more",I).each(function(){j(this).click(function(){Ca.call(this,j(this).parent().parent().parent().parent()[0]);
return false}).mousedown(function(){return false})});g.readonly==false&&j("#mvEventContainer").mousedown(function(a){O.call(this,"m1",a);return false})}}function S(){if(W){W();W=null}}function O(c,a){var h=j(this);S();switch(c){case "dw1":F={type:1,target:h,sx:a.pageX,sy:a.pageY};break;case "dw2":var d=h.width(),f=h.height(),e=h.offset(),i=e.left;e=e.top;var l=g.view=="day"?1:7,m=d%l;d=parseInt(d/l);m>l/2+1&&d++;m=[];for(var n=[],k=0;k<l;k++)m.push({s:k*d+i,e:(k+1)*d+i});n.push({s:e,e:e+f});F={type:2,
target:h,sx:a.pageX,sy:a.pageY,pw:d,xa:m,ya:n,h:f};break;case "dw3":i=h.parent().attr("id").replace("tgCol","");f=h.parent();e=f.offset();d=f.width()+10;f=h.height();var p=V(h);F={type:4,target:h,sx:a.pageX,sy:a.pageY,pXMin:e.left,pXMax:e.left+d,pw:d,h:f,cdi:parseInt(i),fdi:parseInt(i),data:p};break;case "dw4":f=h.height();p=V(h);F={type:5,target:h,sx:a.pageX,sy:a.pageY,h:f,data:p};break;case "dw5":p=j("#weekViewAllDaywk");d=p.width();f=p.height();e=p.offset();p=h.offset();i=e.left;e=e.top;l=7;m=
d%l;d=parseInt(d/l);m>l/2+1&&d++;m=[];n=[];var u=0;for(k=0;k<l;k++){m.push({s:k*d+i,e:(k+1)*d+i});if(p.left>=m[k].s&&p.left<m[k].e)u=k}i={x:u,y:0,di:u};n.push({s:e,e:e+f});p=V(h);e=A("d",p[2],p[3])+1;F={type:6,target:h,sx:a.pageX,sy:a.pageY,data:p,xa:m,ya:n,fdi:i,h:f,dp:e,pw:d};break;case "m1":d=h.width();e=h.offset();i=e.left;e=e.top;l=7;u=h.children().length;m=d%l;d=parseInt(d/l);m>l/2+1&&d++;f=j("#mvrow_0").height();m=[];for(k=0;k<l;k++)m.push({s:k*d+i,e:(k+1)*d+i});m=[];n=[];for(k=0;k<l;k++)m.push({s:k*
d+i,e:(k+1)*d+i});for(k=0;k<u;k++)n.push({s:k*f+e,e:(k+1)*f+e});F={type:3,target:h,sx:a.pageX,sy:a.pageY,pw:d,xa:m,ya:n,h:f};break;case "m2":m=j("#mvrow_0");f=j("#mvrow_1");d=m.width();e=m.offset();f=f.offset();p=h.offset();f=f.top-e.top;i=e.left;e=e.top;l=7;u=m.parent().children().length;m=d%l;d=parseInt(d/l);m>l/2+1&&d++;m=[];n=[];var o=0,t=0;for(k=0;k<l;k++){m.push({s:k*d+i,e:(k+1)*d+i});if(p.left>=m[k].s&&p.left<m[k].e)o=k}for(k=0;k<u;k++){n.push({s:k*f+e,e:(k+1)*f+e});if(p.top>=n[k].s&&p.top<
n[k].e)t=k}i={x:o,y:t,di:t*7+o};p=V(h);e=A("d",p[2],p[3])+1;F={type:7,target:h,sx:a.pageX,sy:a.pageY,data:p,xa:m,ya:n,fdi:i,h:f,dp:e,pw:d}}j("body").noSelect()}function ta(c){if(F){var a=F;switch(a.type){case 1:var h=(new Date).getTime();tp=a.target.offset().top;if(!a.cpwrap){c=pa(a.sy,a.sy+42,tp);var d=K(c.sh,c.sm),f=N(c.sh,c.sm,c.eh,c.em,c.h);a.cpwrap=j("<div class='ca-evpi drag-chip-wrapper' style='top:"+d+"px'/>").html(f);j(a.target).find("div.tg-col-overlaywrapper").append(a.cpwrap);a.cgh=c}c=
a.cpwrap.offset();c.left+=30;a.cpwrap.attr("id",h);d=U(a.target.attr("abbr")+" "+a.cgh.sh+":"+a.cgh.sm);f=U(a.target.attr("abbr")+" "+a.cgh.eh+":"+a.cgh.em);W=function(){j("#"+h).remove();j("#bbit-cal-buddle").css("visibility","hidden")};sa(d,f,false,c);break;case 2:case 3:d=c.srcElement||c.target;var e=(new Date).getTime();if(!a.lasso){if(j(d).hasClass("monthdayshow")){oa.call(j(d).parent()[0],c);break}a.fdi=a.sdi=P(a.xa,a.ya,a.sx,a.sy);a.lasso=j("<div style='z-index: 10; display: block' class='drag-lasso-container'/>");
j(document.body).append(a.lasso);X(a.lasso,a.sdi,a.fdi,a.xa,a.ya,a.h)}a.lasso.attr("id",e);f=Math.max(a.fdi.di,a.sdi.di);var i=g.vstart;d=z("d",Math.min(a.fdi.di,a.sdi.di),i);f=z("d",f,i);W=function(){j("#"+e).remove()};sa(d,f,true,{left:c.pageX,top:c.pageY});break;case 4:if(a.cpwrap){d=z("d",a.cdi,g.vstart);f=z("d",a.cdi,g.vstart);c=ba(a.ny,a.ny+a.h);d.setHours(c.sh,c.sm);f.setHours(c.eh,c.em);if(d.getTime()==a.data[2].getTime()&&f.getTime()==a.data[3].getTime()){a.cpwrap.remove();a.target.show()}else la(a.data,
d,f)}break;case 5:if(a.cpwrap){d=new Date(a.data[2].toString());f=new Date(a.data[3].toString());c=ba(a.top,a.top+nh);d.setHours(c.sh,c.sm);f.setHours(c.eh,c.em);if(d.getTime()==a.data[2].getTime()&&f.getTime()==a.data[3].getTime()){a.cpwrap.remove();a.target.show()}else la(a.data,d,f)}break;case 6:case 7:if(a.lasso){a.cpwrap.remove();a.lasso.remove();d=new Date(a.data[2].toString());f=new Date(a.data[3].toString());c=z("d",a.cdi.di,g.vstart);c=A("d",d,c);d=z("d",c,d);f=z("d",c,f);if(d.getTime()!=
a.data[2].getTime()||f.getTime()!=a.data[3].getTime())la(a.data,d,f)}}a=F=null;j("body").noSelect(false);return false}}function P(c,a,h,d){var f=0,e=0,i=0,l=0;if(c&&c.length!=0){i=c.length;if(h>=c[i-1].e)e=i-1;else for(l=0;l<i;l++)if(h>c[l].s&&h<=c[l].e){e=l;break}}if(a&&a.length!=0){l=a.length;if(d>=a[l-1].e)f=l-1;else for(c=0;c<l;c++)if(d>a[c].s&&d<=a[c].e){f=c;break}}return{x:e,y:f,di:f*i+e}}function X(c,a,h,d,f,e){var i=a.di>h.di?a.di-h.di:h.di-a.di;i++;var l=a.di>h.di?h:a;a=d.length>0?d.length:
1;h=f.length>0?f.length:1;var m=[],n=d[0].e-d[0].s,k=l.x;l=l.y;for(var p=Math.min(document.documentElement.clientWidth,d[a-1].e)-2;l<h&&i>0;){var u=d[k].s,o=k+i>a?a-k:i;for(k=n*o;u+k>=p;)k--;m.push(M(Da,{left:u,top:f[l].s,height:e,width:k}));k=0;i-=o;l++}c.html(m.join(""))}function ua(c,a,h,d){var f=a.pageX-6;a=a.pageY-4;var e=c.width(),i=h[0].s+6,l=d[0].s+4;h=h[h.length-1].e-e-2;d=d[d.length-1].e-21-2;if(f>h)f=h;if(f<=i)f=i+1;if(a<=l)a=l+1;if(a>d)a=d;c.css({left:f,top:a})}var ga={view:"week",weekstartday:1,
theme:0,height:false,url:"",eventItems:[],method:"POST",showday:new Date,onBeforeRequestData:false,onAfterRequestData:false,onRequestDataError:false,onWeekOrMonthToDay:false,quickAddHandler:false,quickAddUrl:"",quickUpdateUrl:"",quickDeleteUrl:"",autoload:false,readonly:false,extParam:[],enableDrag:true,loadDateR:[],timeFormat:" HH:mm",tgtimeFormat:"HH:mm"},ha=j("#gridEvent");if(ha.length==0)ha=j("<div id='gridEvent' style='display:none;'></div>").appendTo(document.body);var va=j("#cal-month-cc");
va.length==0&&j("<div id='cal-month-cc' class='cc'><div id='cal-month-cc-header'><div class='cc-close' id='cal-month-closebtn'></div><div id='cal-month-cc-title' class='cc-title'></div></div><div id='cal-month-cc-body' class='cc-body'><div id='cal-month-cc-content' class='st-contents'><table class='st-grid' cellSpacing='0' cellPadding='0'><tbody></tbody></table></div></div></div>").appendTo(document.body);va=null;var I=j(this);g=j.extend(ga,g);if(g.quickUpdateUrl==null||g.quickUpdateUrl=="")g.enableDrag=
false;var na='<DIV style="WIDTH:${width};top:${top};left:${left};" title="${title}" class="chip chip${i} ${drag}"><div class="dhdV" style="display:none">${data}</div><DIV style="BORDER-BOTTOM-COLOR:${bdcolor}" class=ct>&nbsp;</DIV><DL style="BORDER-BOTTOM-COLOR:${bdcolor}; BACKGROUND-COLOR:${bgcolor1}; BORDER-TOP-COLOR: ${bdcolor}; HEIGHT: ${height}px; BORDER-RIGHT-COLOR:${bdcolor}; BORDER-LEFT-COLOR:${bdcolor}"><DT style="BACKGROUND-COLOR:${bgcolor2}">${starttime} \u2013 ${endtime} ${icon}</DT><DD><SPAN>${content}</SPAN></DD><DIV class=\'resizer\' style=\'display:${redisplay}\'><DIV class=rszr_icon>&nbsp;</DIV></DIV></DL><DIV style="BORDER-BOTTOM-COLOR:${bdcolor}; BACKGROUND-COLOR:${bgcolor1}; BORDER-TOP-COLOR: ${bdcolor}; BORDER-RIGHT-COLOR: ${bdcolor}; BORDER-LEFT-COLOR:${bdcolor}" class=cb1>&nbsp;</DIV><DIV style="BORDER-BOTTOM-COLOR:${bdcolor}; BORDER-TOP-COLOR:${bdcolor}; BORDER-RIGHT-COLOR:${bdcolor}; BORDER-LEFT-COLOR:${bdcolor}" class=cb2>&nbsp;</DIV></DIV>',
za='<div class="rb-o ${eclass}" id="${id}" title="${title}" style="color:${color};"><div class="dhdV" style="display:none">${data}</div><div class="${extendClass} rb-m" style="background-color:${color}">${extendHTML}<div class="rb-i">${content}</div></div></div>',xa=[31,28,31,30,31,30,31,31,30,31,30,31],Da="<div class='drag-lasso' style='left:${left}px;top:${top}px;width:${width}px;height:${height}px;'>&nbsp;</div>",F,W;I.empty();if(!g.height)g.height=document.documentElement.clientHeight;I.css("overflow-y",
"visible").height(g.height-8);if(g.url&&g.autoload)ja();else{q();ga={start:g.vstart,end:g.vend};r(ga.start,ga.end)}j(document).mousemove(function(c){if(F){if(c.pageX<0||c.pageY<0||c.pageX>document.documentElement.clientWidth||c.pageY>=document.documentElement.clientHeight){ta(c);return false}var a=F;switch(a.type){case 1:var h=a.sy,d=c.pageY,f=d-h;if(f>11||f<-11||a.cpwrap){if(f==0)f=21;var e=f%21;if(e!=0){f=e>0?f+21-e:f-21-e;d=a.sy+f;if(f<0)h+=21}if(!a.tp)a.tp=j(a.target).offset().top;c=pa(h,d,a.tp);
var i=K(c.sh,c.sm);if(a.cpwrap){if(a.cgh.sh!=c.sh||a.cgh.eh!=c.eh||a.cgh.sm!=c.sm||a.cgh.em!=c.em){e=N(c.sh,c.sm,c.eh,c.em,c.h);a.cpwrap.css("top",i+"px").html(e)}}else{e=N(c.sh,c.sm,c.eh,c.em,c.h);e=j("<div class='ca-evpi drag-chip-wrapper' style='top:"+i+"px'/>").html(e);j(a.target).find("div.tg-col-overlaywrapper").append(e);a.cpwrap=e}a.cgh=c}break;case 2:var l=a.sx;i=c.pageX;var m=i-l;if(m>5||m<-5||a.lasso){if(!a.lasso){a.lasso=j("<div style='z-index: 10; display: block' class='drag-lasso-container'/>");
j(document.body).append(a.lasso)}if(!a.sdi)a.sdi=P(a.xa,a.ya,l,a.sy);e=P(a.xa,a.ya,i,c.pageY);if(!a.fdi||a.fdi.di!=e.di)X(a.lasso,a.sdi,e,a.xa,a.ya,a.h);a.fdi=e}break;case 3:l=a.sx;i=c.pageX;h=a.sy;d=c.pageY;m=i-l;f=d-h;if(m>5||m<-5||f<-5||f>5||a.lasso){if(!a.lasso){a.lasso=j("<div style='z-index: 10; display: block' class='drag-lasso-container'/>");j(document.body).append(a.lasso)}if(!a.sdi)a.sdi=P(a.xa,a.ya,l,h);e=P(a.xa,a.ya,i,d);if(!a.fdi||a.fdi.di!=e.di)X(a.lasso,a.sdi,e,a.xa,a.ya,a.h);a.fdi=
e}break;case 4:e=a.data;if(e!=null&&e[8]==1){l=a.sx;i=c.pageX;h=a.sy;d=c.pageY;m=i-l;f=d-h;if(m>5||m<-5||f>5||f<-5||a.cpwrap){if(a.cpwrap){c=0;if(i<a.pXMin)c=-1;else if(i>a.pXMax)c=1;if(c!=0){a.cdi+=c;i=j("#tgOver"+a.cdi);if(i.length==1){a.pXMin+=a.pw*c;a.pXMax+=a.pw*c;i.append(a.cpwrap)}else a.cdi-=c}i=a.top+f;c=i%21;if(c!=0)i-=c;if(a.ny!=i){c=ba(i,i+a.h);e=N(c.sh,c.sm,c.eh,c.em,c.h,e[1],false,false,e[7]);a.cpwrap.css("top",i+"px").html(e)}}else{c={sh:e[2].getHours(),sm:e[2].getMinutes(),eh:e[3].getHours(),
em:e[3].getMinutes(),h:a.h};a.target.hide();i=K(c.sh,c.sm);a.top=i;e=N(c.sh,c.sm,c.eh,c.em,c.h,e[1],false,false,e[7]);e=j("<div class='ca-evpi drag-chip-wrapper' style='top:"+i+"px'/>").html(e);c=a.target.parent().attr("id").replace("tgCol","#tgOver");j(c).append(e);a.cpwrap=e}a.ny=i}}break;case 5:e=a.data;if(e!=null&&e[8]==1){h=a.sy;d=c.pageY;f=d-h;if(f!=0||a.cpwrap)if(a.cpwrap){nh=a.h+f;i=nh%21;nh=i>1?nh-i+21:nh-i;if(a.nh!=nh){K(e[2].getHours(),e[2].getMinutes());c=ba(a.top,a.top+nh);e=N(c.sh,c.sm,
c.eh,c.em,c.h,e[1],"100%",true,e[7]);a.cpwrap.html(e)}a.nh=nh}else{c={sh:e[2].getHours(),sm:e[2].getMinutes(),eh:e[3].getHours(),em:e[3].getMinutes(),h:a.h};a.target.hide();i=K(c.sh,c.sm);a.top=i;e=N(c.sh,c.sm,c.eh,c.em,c.h,e[1],"100%",true,e[7]);e=j("<div class='ca-evpi drag-chip-wrapper' style='top:"+i+"px'/>").html(e);c=a.target.parent().attr("id").replace("tgCol","#tgOver");j(c).append(e);a.cpwrap=e}}break;case 6:l=a.sx;i=c.pageX;m=i-l;if(m>5||m<-5||a.lasso){if(!a.lasso){e=a.dp>1?(a.pw-4)*1.5:
a.pw-4;f=a.target.clone();a.dp>1&&f.find("div.rb-i>span").prepend("("+a.dp+" "+i18n.xgcalendar.day_plural+")&nbsp;");e=j("<div class='drag-event st-contents' style='width:"+e+"px'/>").append(f).appendTo(document.body);a.cpwrap=e;a.lasso=j("<div style='z-index: 10; display: block' class='drag-lasso-container'/>");j(document.body).append(a.lasso)}ua(a.cpwrap,c,a.xa,a.ya);e=P(a.xa,a.ya,i,c.pageY);if(!a.cdi||a.cdi.di!=e.di)X(a.lasso,e,{x:e.x,y:e.y,di:e.di+a.dp-1},a.xa,a.ya,a.h);a.cdi=e}break;case 7:l=
a.sx;h=a.sy;i=c.pageX;d=c.pageY;m=i-l;f=d-h;if(m>5||m<-5||f>5||f<-5||a.lasso){if(!a.lasso){e=a.dp>1?(a.pw-4)*1.5:a.pw-4;f=a.target.clone();a.dp>1&&f.find("div.rb-i>span").prepend("("+a.dp+" "+i18n.xgcalendar.day_plural+")&nbsp;");e=j("<div class='drag-event st-contents' style='width:"+e+"px'/>").append(f).appendTo(document.body);a.cpwrap=e;a.lasso=j("<div style='z-index: 10; display: block' class='drag-lasso-container'/>");j(document.body).append(a.lasso)}ua(a.cpwrap,c,a.xa,a.ya);e=P(a.xa,a.ya,i,
c.pageY);if(!a.cdi||a.cdi.di!=e.di)X(a.lasso,e,{x:e.x,y:e.y,di:e.di+a.dp-1},a.xa,a.ya,a.h);a.cdi=e}}}return false}).mouseup(ta);this[0].bcal={sv:function(c){if(c!=g.view){I.empty();g.view=c;q();da()}},rf:function(){ja()},gt:function(c){c||(c=new Date);g.showday=c;q();da()},pv:function(){switch(g.view){case "day":g.showday=z("d",-1,g.showday);break;case "week":g.showday=z("w",-1,g.showday);break;case "month":g.showday=z("m",-1,g.showday)}q();da()},nt:function(){switch(g.view){case "day":g.showday=
z("d",1,g.showday);break;case "week":g.showday=z("w",1,g.showday);break;case "month":var c=g.showday.getDate();g.showday=z("m",1,g.showday);var a=g.showday.getDate();if(c!=a)g.showday=z("d",0-a,g.showday)}q();da()},go:function(){return g},so:function(c){g=j.extend(g,c)}};return this};j.fn.BCalSwtichview=function(g){return this.each(function(){this.bcal&&this.bcal.sv(g)})};j.fn.BCalReload=function(){return this.each(function(){this.bcal&&this.bcal.rf()})};j.fn.BCalGoToday=function(g){return this.each(function(){this.bcal&&
this.bcal.gt(g)})};j.fn.BCalPrev=function(){return this.each(function(){this.bcal&&this.bcal.pv()})};j.fn.BCalNext=function(){return this.each(function(){this.bcal&&this.bcal.nt()})};j.fn.BcalGetOp=function(){if(this[0].bcal)return this[0].bcal.go();return null};j.fn.BcalSetOp=function(g){if(this[0].bcal)return this[0].bcal.so(g)}})(jQuery);
